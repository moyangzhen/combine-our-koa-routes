!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=21)}([function(e,t,o){"use strict";t.a={DB_URL:"mongodb://test:123456@8.134.11.242:27017//testdb",REDIS:{host:"8.134.11.242",port:15001,password:"123456"},JWT_SECRET:"a&*38QthAKuiRwISGLotgq^3%^$zvA3A6Hfr8MF$jM*dWcwAW&9NGp7*b53!"}},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-jwt")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("koa-body")},function(e,t){e.exports=require("koa-json")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa2-cors")},function(e,t){e.exports=require("koa-combine-routers")},function(e,t){e.exports=require("svg-captcha")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("koa-helmet")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("koa-compress")},function(e,t,o){"use strict";t.a=(e,t)=>t().catch(t=>{if(401!==t.status)throw t;e.status=401,e.body={code:401,msg:"Protect resource, use Authorization header to get access\n"}})},function(e,t,o){"use strict";var r=o(10),n=o.n(r),i=o(1),s=o.n(i),a=o(11),c=o.n(a),u=o(2),p=o.n(u),d=o(12),l=o(0);const f={host:l.a.REDIS.host,port:l.a.REDIS.port,password:l.a.REDIS.password,detect_buffers:!0,retry_strategy:function(e){return"ECONNREFUSED"===e.error.code?new Error("The server refused the connection"):e.total_retry_time>36e5?new Error("Retry time exhausted"):e.times_connected>10?void 0:Math.max(100*e.attempt,3e3)}},g=Object(d.promisifyAll)(p.a.createClient(f));g.on("error",e=>{console.log("Redis client error"+e)});var b=new class{constructor(){}async getCaptcha(e){const t=e.request.query,o=c.a.create({size:4,ignoreChars:"0o1i",color:!0,noise:Math.floor(5*Math.random()),height:38,width:150});var r,n,i;r=t.sid,n=o.text,i=600,void 0!==n&&null!=n&&""!==n&&("string"==typeof n?"undefine"!=typeof i?g.set(r,n,"EX",i):g.set(r,n):"object"==typeof n&&Object.keys(n).forEach(e=>{g.hset(r,e,n[e],p.a.print)})),e.body={code:200,data:o.data}}};const h=new s.a;h.prefix("/public"),h.get("/getCaptcha",b.getCaptcha);var x=h,m=o(13),y=o.n(m);var v=async function(e){let t=y.a.createTransport({host:"smtp.qq.com",port:587,secure:!1,auth:{user:"624973033@qq.com",pass:"ejjpuhxzlbqpbfjg"}});return"Message sent: %s, "+(await t.sendMail({from:'"认证邮件" <624973033@qq.com>',to:e.email,subject:""!==e.user?`你好开发者,${e.user}!<慕课网前端全栈实战>注册码`:"《慕课网前端全栈实战》注册码",text:`您在《慕课网前端全栈实战》课程中注册，您的邀请码是${e.code},邀请码的过期时间:${e.expire}`,html:`  <div style="color:#676767;width:600px;margin:0 auto;padding-bottom: 50px;position:relative;">\n    <div style="height: 60px;\nbackground: #393d49;\nline-height: 60px;\ncolor: #58a36f;\nfont-size: 18px;\npadding-left: 10px;">\n      Imooc社区-欢迎来到官方社区\n    </div>\n    <div style="padding:25px;">\n      <div>您好，${e.user}童靴，重置链接有效时间30分钟，请在${e.expire}之前重置您的密码:</div>\n      <a href="http://www.imooc.com" style=" padding: 10px 20px;color: #fff;background: #009e94;display:inline-block;margin:15px 0;">重置密码</a>\n  <div style="padding:5px;background:#f2f2f2;">如果该邮件不是由你本人操作，请勿进行激活！否则你的邮箱将会被他人绑定</div>\n    </div>\n    <div style="background: #fafafa;\ncolor: #b4b4b4;\ntext-align: center;\nline-height: 45px;\nheight: 45px;\nposition: absolute;\nleft: 0;\nbottom: 0;\nwidth: 100%;\n      ">系统邮件，请勿直接回复</div>`})).messageId},q=o(14),w=o.n(q),j=o(15),k=o.n(j);var E=new class{constructor(){}async forget(e){const{body:t}=e.request;console.log(t);try{let o=await v({code:"1234",expire:w()().add(30,"minutes").format("YYYY-MM-DD HH:mm:ss"),email:t.username,user:"ludaohua"});e.body={code:200,data:o,msg:"邮件发送成功"}}catch(e){console.log(e)}}async login(e){console.log("hello login");let t=k.a.sign({_id:"brian"},l.a.JWT_SECRET,{expiresIn:"1d"});e.body={code:200,token:t}}async regist(e){}};const _=new s.a;_.prefix("/login"),_.post("/forget",E.forget),_.get("/login",E.login),_.post("/regist",E.regist);var S=_;t.a=n()(x,S)},function(e,t,o){"use strict";o.r(t),function(e){var t=o(3),r=o.n(t),n=o(4),i=o.n(n),s=o(5),a=o.n(s),c=o(6),u=o.n(c),p=o(7),d=o.n(p),l=o(8),f=o.n(l),g=o(9),b=o.n(g),h=o(20),x=o(16),m=o.n(x),y=o(17),v=o.n(y),q=o(18),w=o.n(q),j=o(0),k=o(19);const E=new r.a,_="production"!=production,S=i()({secret:j.a.JWT_SECRET}).unless({path:[/^\/public/,/\/login/]}),M=f()([u()(),v()(a.a.join(e,"../public")),b()(),d()({pretty:!1,param:"pretty"}),m()(),k.a,S]);_||E.use(w()()),E.use(M),E.use(Object(h.a)()),E.listen(3e3)}.call(this,"src")}]);